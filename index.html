<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Additional iOS camera permission meta tags -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-mobile-web-app-title" content="Neural Network AR">
    <meta name="theme-color" content="#000000">
    <title>Neural Network AR Visualizer</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="ar-fixes.css">
    <!-- AR.js and Three.js libraries -->
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.3.0/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <!-- TensorFlow.js for neural network implementation -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <!-- Custom scripts -->
    <script src="js/neuralNetwork.js" defer></script>
    <script src="js/arVisualization.js" defer></script>
    <script src="js/app.js" defer></script>
    
    <!-- Fix for mobile viewport issues -->
    <script>
        // Fix for mobile viewport issues
        function fixMobileViewport() {
            // Set viewport dimensions
            const setViewportDimensions = () => {
                document.documentElement.style.width = window.innerWidth + 'px';
                document.documentElement.style.height = window.innerHeight + 'px';
                document.body.style.width = window.innerWidth + 'px';
                document.body.style.height = window.innerHeight + 'px';
                
                // Fix AR elements
                const arVideo = document.querySelector('#arjs-video');
                const arCanvas = document.querySelector('canvas.a-canvas');
                const arScene = document.querySelector('a-scene');
                
                if (arVideo) {
                    arVideo.style.width = window.innerWidth + 'px';
                    arVideo.style.height = window.innerHeight + 'px';
                    arVideo.style.objectFit = 'cover';
                    arVideo.style.position = 'fixed';
                    arVideo.style.top = '0';
                    arVideo.style.left = '0';
                    arVideo.style.right = '0';
                    arVideo.style.bottom = '0';
                    arVideo.style.zIndex = '-1';
                }
                
                if (arCanvas) {
                    arCanvas.style.width = window.innerWidth + 'px';
                    arCanvas.style.height = window.innerHeight + 'px';
                    arCanvas.style.position = 'fixed';
                    arCanvas.style.top = '0';
                    arCanvas.style.left = '0';
                    arCanvas.style.right = '0';
                    arCanvas.style.bottom = '0';
                }
                
                if (arScene) {
                    arScene.style.width = window.innerWidth + 'px';
                    arScene.style.height = window.innerHeight + 'px';
                    arScene.style.position = 'fixed';
                    arScene.style.top = '0';
                    arScene.style.left = '0';
                    arScene.style.right = '0';
                    arScene.style.bottom = '0';
                }
            };
            
            // Initial setup
            setViewportDimensions();
            
            // Update on resize and orientation change
            window.addEventListener('resize', setViewportDimensions);
            window.addEventListener('orientationchange', setViewportDimensions);
        }
        
        // Run on load
        window.addEventListener('load', fixMobileViewport);
    </script>
    
    <!-- Fix for AR.js video element -->
    <script>
        // Fix for AR.js video element that might be causing the green screen
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for AR.js to create the video element
            setTimeout(function() {
                const video = document.querySelector('#arjs-video');
                if (video) {
                    console.log('Fixing AR.js video element');
                    video.style.width = '100%';
                    video.style.height = '100%';
                    video.style.objectFit = 'cover';
                    video.style.position = 'fixed';
                    video.style.left = '0';
                    video.style.top = '0';
                    video.style.right = '0';
                    video.style.bottom = '0';
                    video.style.zIndex = '-1';
                    
                    // Additional iOS fixes
                    if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                        video.style.transform = 'none';
                        video.style.webkitTransform = 'none';
                    }
                    
                    // Additional fix for mobile
                    document.body.style.width = '100%';
                    document.body.style.height = '100%';
                    document.body.style.overflow = 'hidden';
                    document.body.style.position = 'fixed';
                    document.body.style.top = '0';
                    document.body.style.left = '0';
                    document.body.style.right = '0';
                    document.body.style.bottom = '0';
                }
            }, 1000);
            
            // Fix for mobile orientation changes
            window.addEventListener('resize', function() {
                const video = document.querySelector('#arjs-video');
                const canvas = document.querySelector('canvas.a-canvas');
                
                if (video) {
                    video.style.width = '100%';
                    video.style.height = '100%';
                    video.style.right = '0';
                    video.style.bottom = '0';
                }
                
                if (canvas) {
                    canvas.style.width = '100%';
                    canvas.style.height = '100%';
                    canvas.style.right = '0';
                    canvas.style.bottom = '0';
                }
            });
        });
    </script>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <h1>Neural Network AR Visualizer</h1>
            <div class="spinner"></div>
            <p>Loading AR experience...</p>
        </div>
    </div>

    <div class="info-panel" id="infoPanel">
        <h2>Neural Network Visualization</h2>
        <p>This AR experience shows a neural network during inference.</p>
        <p>To use: Point your camera at a <a href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" target="_blank">Hiro marker</a>.</p>
        <button id="infoCloseBtn">Got it</button>
    </div>

    <div class="controls">
        <button id="infoBtn" class="control-btn">‚ÑπÔ∏è</button>
        <button id="resetBtn" class="control-btn">üîÑ</button>
    </div>

    <!-- A-Frame scene for AR -->
    <a-scene 
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; trackingMethod: best; maxDetectionRate: 30; sourceWidth: 1280; sourceHeight: 960; displayWidth: 1280; displayHeight: 960;"
        renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true; alpha: true; colorManagement: true; physicallyCorrectLights: false;"
        vr-mode-ui="enabled: false"
        loading-screen="enabled: false"
        device-orientation-permission-ui="enabled: false">
        
        <!-- Use only the Hiro marker for testing -->
        <a-marker preset="hiro" id="hiroMarker" markerhandler smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
            <!-- Neural network visualization will be added here programmatically -->
        </a-marker>
        
        <!-- Camera with user gestures enabled -->
        <a-entity camera look-controls="enabled: false"></a-entity>
    </a-scene>

    <div class="tutorial" id="tutorial">
        <div class="tutorial-step active" id="step1">
            <p>Point your camera at a Hiro marker</p>
        </div>
        <div class="tutorial-step" id="step2">
            <p>Watch the neural network appear</p>
        </div>
        <div class="tutorial-step" id="step3">
            <p>Tap on neurons to see details</p>
        </div>
    </div>
</body>
</html> 